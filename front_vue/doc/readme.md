# Документация

## Get параметры в URL

Структура храниться в `export enum UrlGetParams`

-   `&y` - Широта;
-   `&x` - Долгота;
-   `&z` - Приближение карты;
-   `&v` - Режим отображения карты, или места. `export enum UrlGetParamsTypeView`;
    -   `mm` - Главная карта, обычный режим;
-   `&c` - Идентификатор канала, с местами;

-   Можно указать в `URL`, `GET` параметры координаты и масштаб на котором нужно сфокусироваться. например `/?x=59.8596481540678&y=30.17500932540894&g=1&v=mm&z=16`

## Структура статических фалов

Я хочу чтобы большая часть логики приложения была закеширована на сервере, благодаря этому можно нивелировать недостаток мощностей процессоров, иза за небольшого бюджета проекта, и значительно сократить расходны на аренду серверов. Я думаю это поможет выиграть схватку с большим трафиком. Поэтому ту часть проекта, которую можно закешировать без проблем, я закешировал.

Схема связей у статических файлов приведена в `doc/static/schema_static_file.sketch`

### meta_data - Хранит связи для данных

В этой папке хранятся файлы с информаций необходимая для связи `Понятное Имя` = `Место где хранятся эти данные`

#### Структура channel_geomap

-   `channel_geomap.json` - Информация для `geomap/geomap_ИмяТочкиРадиусов.json`

    ```json
    {
        // Список доступных ИмяТочкиРадиусов
        "names_radius": {
            // Идентификатор радиуса для GET параметра. Передается в параметр `&g`
            "1": {
                // По этому имени пользователи будут фильтровать "Имена точек радиуса".
                "hum": "Санкт-Петербург - радиус 200км от дворцовой площади",
                // Путь к статическому файлу, который хранить в себе информацию обо всех местах в этом радиусе.
                "name_path": "@/geomap/geomap_ИмяТочкиРадиусов_VERSION.json",
                // ID БД шарда, где храниться группа
                "shard": 1
            }
        }
    }
    ```

### geomap - Хранит информацию о местах

Координаты интересных мест соответствуют схеме `interface Tgeomap`, они хранятся в файлах `geomap/geomap_ИмяТочкиРадиусов_VERSION.json`.

-   `ИмяТочкиРадиусов` - Это условная точка на карте, с условным радиусом, которая хранит в себе, поверхностную информацию обо всех местах, которые расположен в этом радиусе. (Это используется для того, чтобы кешировать места, а не постоянно формировать новый `geomap`, и не нагружать лишний раз сервер).

-   `VERSION` - Версия файла, это нужно при обновление файла, чтобы браузеры скачивал новую версия файла, а не брал старую версию из кеша (Браузер будет скачивать новую версию, потому что имя файла отличаются)

#### Структура файлов geomap_ИмяТочкиРадиусов_VERSION

```json
{
    // Формат координат - широта,долгота
    "projection": "EPSG:4326",
    // Стили отображения маркера
    "geom_place_style": {
        "ИмяГруппы": {
            // Человеко понятное имя для слоя
            "name_marker":"ЛюбоеИмя",
            // URL к изображению иконки. Знак `@/` указывает на то, что host возьмется переменных ENV_default_host_to_src
            "img_url": "",
            // Масштаб изображению
            "img_size": [1, 1]
        }
    },
    // Список того чем можно заняться в указном месте
    // Названия для фильтрации, отвечающая на вопрос что делать в этом месте  - (танцевать,кататься на лыжах,заниматься спортом) ?
    "geom_whattodo_det":{
        1:"Танцевать",
        2:"Петь",
        3:"Есть"
    }
    // Группы мест
    "geom_place_coord":{
        "ИмяГруппы": {
            // Координаты(широта, долгота) с точностью - 3 знака после запятой
            "59.86369521994118,30.16211789237823": {
                // Уникальный идентификатор места. Это ID уникален во всем приложение.
                // Благодаря этому ID, можно сделать ссылка на это место.
                "id":1,
                // Рейтинг места. Максимум 12 баллов.
                // Рейтинг - это субъективная оценка, которая не обязательно показывает качества места.
                // Рейтинг показывает уважение к этому месту, и на сколько оно(по субъективному взгляду пользователей) лучше ближайших конкурентов.
                // Я думаю рейтинг поможет пользователям определиться, какое место лучше посетить первым.
                "rating":1,
                // Короткое название места. Максимальная длинна 16 символов
                "simpl_name": "ЛюбоеИмя",
                // Адрес места
                "address":"АдресМеста",
                // Идентификатор того чем можно заняться в это месте. Заполняется в "geom_whattodo_det"
                // Если это место подходит под несколько фильтров, то перечислите их через запятую.
                "whattodo":[1,2,3]
            }
        }
    }
}
```

-   Поверхностная информация о месте, храниться в `geomap_ИмяРадиусМест.json`, - состоит из
    -   Координаты
    -   Тип места
    -   Рейтинга
    -   Имя места
    -   Адреса
    -   Чем тут можно заняться

### public_place_details - Хранит публичную детальная информация о конкретном месте

В этой папке находятся файлы, которые хранят публичную детальную информацию о месте.

Шаблон для имени = `ppd_ИдентификаторМеста.json`

#### Структура файлов ppd_ИдентификаторМеста

-   Публичная детальная информация о месте, храниться в `ppd_ИдентификаторМеста.json`, - состоит из поверхностной информации и:
    -   **Когда это место возможно посетить**(`WhenPossibleVisit`):
        -   **Постоянный график работы** (`StaticWorkSchedule`) = У этого места есть постоянный график работы когда его можно посетить. (Ресторан,Бар,Спортзал,Музей)
        -   **Одноразовое временно событие** (`OneTimeTemporaryEvent`) = указать с какого и до какого числа оно будет происходить. (VK Фест,Стендап,Концерт,Новый год,Алые паруса)
        -   **Переодическое место** (`PeriodicPlace`) = указать период когда это место доступно, и если нужно, то и дни график работы. (Зимняя рыбалка,Горнолыжна,Морские пляжи,Карьерные пляжи,Летний ресторан,Петергофские фонтаны)
    -   **Средняя стоимость посещения** (`AverageCostVisit`) = Либо сколько вы обычно тратите денег в этом месте, либо это средняя стоимость билета.
    -   **Средняя людность** (`AveragePopulation`):
        -   **Дискомфортная частая людность** (`UncomfortableFrequentCrowding`) - обычно посетителей больше, чем это место может в себя принять.
        -   **Дискомфортная людность по выходным и праздникам, но в рабочие дни комфортная** (`UncomfortableFrequentCrowdingExceptWeekends`)- обычно, в выходные и праздники, посетителей больше, чем это место может в себя принять.
        -   **Комфортная людность** (`ComfortableCrowd`) - может быть даже много посетителей, но вы не испытываете дискомфорт от неё.
        -   **Уединение** (`Privacy`) - В этом месте бывает мало людей, но это хорошо.
        -   **Одиночество** (`Loneliness`) - этом месте бывает мало людей, но это плохо.
    -   **Это место в интернете** (`InternetСontacts`):
        -   Список мобильных телефонов (`phones`)
        -   Ссылки на официальный сайт (`website`)
        -   Telegram (`tg`)
        -   VK (`vk`)
        -   Другие соц сети (`any_social`)
        -   Ссылка в "Яндекс Карты" (`yandex_map`)
        -   Другие ссылки связанные с этим местом (`any_link`)
    -   **У скольких пользователей, это место добавлено в избранные** (`FavoritesCountMore`) = Для конфиденциальности это число приблизительное, например в виде `более 50`.

Структура в `export interface Tpublic_place_details`

```json
{
    // Когда это место возможно посетить: [StaticWorkSchedule|OneTimeTemporaryEvent|PeriodicPlace]
    "WhenPossibleVisit": {
        // Вариант для - "График работы"
        "type": "StaticWorkSchedule",
        "data": {
            // Дни недели в которые это место работает.
            // Если в какой-то день недели это место не работает, то это день не нужно указывать
            "weekday": {
                "Monday": { "start": "08:10", "end": "20:00" },
                "Tuesday": { "start": "08:10", "end": "20:00" },
                "Wednesday": { "start": "08:10", "end": "20:00" },
                "Thursday": { "start": "08:10", "end": "20:00" },
                "Friday": { "start": "08:10", "end": "20:00" },
                "Saturday": { "start": "08:10", "end": "20:00" },
                "Sunday": { "start": "08:10", "end": "20:00" }
            }
        },
        // Вариант для - "Одноразовое временно событие"
        "type": "OneTimeTemporaryEvent",
        "data": {
            // Дата(ы) начала события.
            "dates": [
                // День.Месяц.Год Час:Минуты
                "01.01.2022 18:00",
                "02.01.2022 17:00",
                "03.01.2022 18:30"
            ]
        },
        // Вариант для - "Переодическое место"
        "type": "PeriodicPlace",
        "data": {
            // Начала периода: День.Месяц.Год Час:Минуты
            "start_period": "01.01.2022 18:00",
            // Конец периода: День.Месяц.Год Час:Минуты
            "end_period": "01.05.2022 18:00",
            // Дни недели в которые это место работает.
            // Если в какой-то день недели это место не работает, то это день не нужно указывать
            // Если у этого места нет графика работы, то не нужно указывать ключ "weekday"
            "weekday": {
                "Monday": { "start": "08:10", "end": "20:00" },
                "Tuesday": { "start": "08:10", "end": "20:00" },
                "Wednesday": { "start": "08:10", "end": "20:00" },
                "Thursday": { "start": "08:10", "end": "20:00" },
                "Friday": { "start": "08:10", "end": "20:00" },
                "Saturday": { "start": "08:10", "end": "20:00" },
                "Sunday": { "start": "08:10", "end": "20:00" }
            }
        }
    },
    // Средняя стоимость посещения.
    "AverageCostVisit": {
        // Валюта измерения [Рубль-RUB|Доллар-USD|Евро-EUR|Юань-CNY]
        "currency": "",
        // Значение
        "value": 100
    },
    // Средняя людность:
    // [UncomfortableFrequentCrowding|UncomfortableFrequentCrowdingExceptWeekends|ComfortableCrowd|Privacy|Loneliness]
    "AveragePopulation": "",
    // Это место в интернете
    "InternetСontacts": {
        // Список мобильных телефонов
        "phones": [""],
        // Сайт
        "website": "",
        "tg": "",
        "vk": "",
        // Ссылка на другие соц сети
        "any_social": [""],
        // Ссылка на яндекс карты
        "yandex_map": "",
        // Другие ссылки
        "any_link": [""]
    },
    // У скольких пользователей, это место добавлено в избранные.
    // Для конфиденциальности это число приблизительное, в примере это число отобразиться как `более 50`
    "FavoritesCountMore": 50
}
```

## Описание EPSG:4326

![](https://natworld.info/wp-content/uploads/2020/07/kak-opredelit-po-karte-geograficheskie-koordinaty.jpg)

Границы:

-   Широта: -90.000000000000000,+90.000000000000000
-   Долгота: -180.000000000000000,+180.000000000000000

## Инфраструктура

### Шардирвоание БД

-   Шардирвоание БД:
    -   Для простоты реализации сделаем один БД шард, [0,100_000] групп.
    -   Чтобы диапазоны заполнялись полностью без пустот(например группа удалилась и id освободился) нужно создать таблицу для удаленных группы, и для новых групп брать id в первую очередь из этой таблицы, а если она пустая, то брать новый.
    -   Каждый шард храниться в отдельной БД, и вся информация о группе также храниться в этой БД.
    -   Информация о идентификаторе шард группы будет храниться в мето данных о группе. В ключе "shard"
    -   > Такой вариант позволяет горизонтально раст в объеме хранения данных.
